<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Archive</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #2d3748;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .config-warning {
            background: #fed7d7;
            border: 2px solid #fc8181;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: #742a2a;
        }

        .config-warning h3 {
            margin-bottom: 10px;
        }

        .config-warning code {
            background: #fff5f5;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            letter-spacing: -1px;
            margin-bottom: 15px;
        }

        .subtitle {
            color: #4a5568;
            font-size: 1em;
            line-height: 1.6;
            font-weight: 500;
        }

        .auth-section {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.95em;
            font-weight: 600;
            border-radius: 10px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn:active {
            transform: translateY(0);
        }

        .user-info {
            display: none;
            align-items: center;
            gap: 20px;
            color: #4a5568;
            font-weight: 600;
        }

        .main-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            height: fit-content;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .sidebar h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: 700;
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-size: 0.9em;
            font-weight: 600;
        }

        select, input[type="text"], input[type="email"], input[type="password"], input[type="file"] {
            width: 100%;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e2e8f0;
            color: #2d3748;
            font-family: inherit;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
            font-size: 0.95em;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .content-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .upload-section h3 {
            color: #2d3748;
            margin-bottom: 25px;
            font-size: 1.5em;
            font-weight: 700;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .file-upload-area {
            border: 3px dashed #cbd5e0;
            padding: 50px;
            text-align: center;
            border-radius: 15px;
            background: #f7fafc;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 25px;
        }

        .file-upload-area:hover {
            background: #edf2f7;
            border-color: #667eea;
        }

        .file-upload-area.uploading {
            border-color: #667eea;
            background: #e6f2ff;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
            display: none;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            width: 0%;
        }

        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        .media-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .media-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .media-icon {
            font-size: 4em;
            text-align: center;
            margin-bottom: 15px;
        }

        .media-title {
            color: #2d3748;
            font-size: 1.3em;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .media-info {
            color: #718096;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .media-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 0.85em;
            flex: 1;
        }

        .player-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .player-title {
            color: #2d3748;
            font-size: 1.5em;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 700;
        }

        video, audio {
            width: 100%;
            border-radius: 12px;
            background: #000;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-content h2 {
            color: #2d3748;
            margin-bottom: 30px;
            text-align: center;
            font-weight: 700;
        }

        .close-modal {
            float: right;
            font-size: 2em;
            cursor: pointer;
            color: #a0aec0;
            line-height: 0.8;
            transition: all 0.3s;
        }

        .close-modal:hover {
            color: #667eea;
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .stat-value {
            font-size: 3em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .stat-label {
            color: #718096;
            margin-top: 10px;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="config-warning" id="configWarning" style="display: none;">
            <h3>‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase</h3>
            <p>–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∏ –∑–∞–º–µ–Ω–∏—Ç–µ <code>YOUR_SUPABASE_URL</code> –∏ <code>YOUR_SUPABASE_KEY</code> –Ω–∞ –≤–∞—à–∏ –Ω–∞—Å—Ç–æ—è—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ Supabase –ø—Ä–æ–µ–∫—Ç–∞.</p>
        </div>

        <header>
            <h1>MEDIA ARCHIVE</h1>
            <p class="subtitle" style="font-size: 1em; margin-top: 10px;">Society for the Support of Applied and Deep Research</p>
            <p class="subtitle" style="font-size: 0.95em; margin-top: 5px;">–¢–æ–≤–∞—Ä–∏—Å—Ç–≤–æ —Å–ø—Ä–∏—è–Ω–Ω—è –ø—Ä–∏–∫–ª–∞–¥–Ω–∏–º —Ç–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∏–º –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è–º</p>
            <p class="subtitle" style="font-size: 0.9em; margin-top: 5px;">–û–±—â–µ—Å—Ç–≤–æ –°–æ–¥–µ–π—Å—Ç–≤–∏—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º –∏ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º</p>
            <p class="subtitle" style="font-size: 0.85em; margin-top: 10px; font-style: italic; color: #718096;">–ö–æ–ª–ª–µ–∫—Ü–∏—è –Ω–∞—É—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –∞—É–¥–∏–æ, –≤–∏–¥–µ–æ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>
            
            <div class="auth-section" id="authButtons">
                <button class="btn" onclick="showModal('loginModal')">–í—Ö–æ–¥</button>
                <button class="btn" onclick="showModal('registerModal')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
            
            <div class="user-info" id="userInfo">
                <span>üë§ <span id="username"></span></span>
                <button class="btn" onclick="toggleUpload()">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                <button class="btn" onclick="logout()">–í—ã—Ö–æ–¥</button>
            </div>
        </header>

        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-value" id="totalMedia">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalAudio">0</div>
                <div class="stat-label">–ê—É–¥–∏–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalVideo">0</div>
                <div class="stat-label">–í–∏–¥–µ–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalText">0</div>
                <div class="stat-label">–¢–µ–∫—Å—Ç—ã</div>
            </div>
        </div>

        <div class="player-section" id="playerSection">
            <div class="player-title" id="playerTitle">–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç</div>
            <div id="playerContainer"></div>
        </div>

        <div class="upload-section" id="uploadSection">
            <h3>üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª</h3>
            <div class="file-upload-area" id="fileUploadArea" onclick="document.getElementById('fileInput').click()">
                <div style="font-size: 3em; margin-bottom: 10px;">üìÅ</div>
                <div style="color: #4a5568; font-weight: 600;" id="uploadText">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</div>
                <div style="font-size: 0.85em; margin-top: 10px; color: #718096;">
                    –ê—É–¥–∏–æ: MP3, WAV, OGG | –í–∏–¥–µ–æ: MP4, WebM | –¢–µ–∫—Å—Ç—ã: PDF, TXT
                </div>
                <div class="progress-bar" id="progressBar">
                    <div class="progress-bar-fill" id="progressBarFill"></div>
                </div>
            </div>
            <input type="file" id="fileInput" accept="audio/*,video/*,.pdf,.txt" style="display: none;" onchange="handleFileSelect(event)">
            
            <div class="form-grid">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="uploadTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                </div>
                <div class="form-group">
                    <label>–ê–≤—Ç–æ—Ä/–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</label>
                    <input type="text" id="uploadAuthor" placeholder="–ò–º—è –∞–≤—Ç–æ—Ä–∞">
                </div>
                <div class="form-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select id="uploadCategory">
                        <option value="music">–ú—É–∑—ã–∫–∞</option>
                        <option value="speech">–†–µ—á—å</option>
                        <option value="interview">–ò–Ω—Ç–µ—Ä–≤—å—é</option>
                        <option value="documentary">–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ</option>
                        <option value="film">–§–∏–ª—å–º</option>
                        <option value="lecture">–õ–µ–∫—Ü–∏—è</option>
                        <option value="book">–ö–Ω–∏–≥–∞</option>
                        <option value="article">–°—Ç–∞—Ç—å—è</option>
                        <option value="research">–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</option>
                        <option value="thesis">–î–∏—Å—Å–µ—Ä—Ç–∞—Ü–∏—è</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–ì–æ–¥:</label>
                    <input type="text" id="uploadYear" placeholder="–ì–æ–¥ –∑–∞–ø–∏—Å–∏">
                </div>
                <div class="form-group full-width">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <input type="text" id="uploadDescription" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ">
                </div>
            </div>
            
            <button class="btn" id="uploadBtn" onclick="uploadFile()">‚úì –î–æ–±–∞–≤–∏—Ç—å –≤ –∞—Ä—Ö–∏–≤</button>
        </div>

        <div class="main-content">
            <aside class="sidebar">
                <h3>üîç –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã</h3>
                
                <div class="filter-group">
                    <label>–ü–æ–∏—Å–∫:</label>
                    <input type="text" id="searchInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä..." onkeyup="applyFilters()">
                </div>
                
                <div class="filter-group">
                    <label>–¢–∏–ø –º–µ–¥–∏–∞:</label>
                    <select id="filterType" onchange="applyFilters()">
                        <option value="all">–í—Å–µ</option>
                        <option value="audio">–ê—É–¥–∏–æ</option>
                        <option value="video">–í–∏–¥–µ–æ</option>
                        <option value="text">–¢–µ–∫—Å—Ç—ã</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select id="filterCategory" onchange="applyFilters()">
                        <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                        <option value="music">–ú—É–∑—ã–∫–∞</option>
                        <option value="speech">–†–µ—á—å</option>
                        <option value="interview">–ò–Ω—Ç–µ—Ä–≤—å—é</option>
                        <option value="documentary">–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ</option>
                        <option value="film">–§–∏–ª—å–º</option>
                        <option value="lecture">–õ–µ–∫—Ü–∏—è</option>
                        <option value="book">–ö–Ω–∏–≥–∞</option>
                        <option value="article">–°—Ç–∞—Ç—å—è</option>
                        <option value="research">–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</option>
                        <option value="thesis">–î–∏—Å—Å–µ—Ä—Ç–∞—Ü–∏—è</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                
                <button class="btn" onclick="clearFilters()" style="width: 100%; margin-top: 10px;">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            </aside>

            <div class="content-area">
                <div class="media-grid" id="mediaGrid">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞-–∞—Ä—Ö–∏–≤–∞...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('loginModal')">&times;</span>
            <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="loginEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <button class="btn" onclick="login()" style="width: 100%; margin-top: 20px;">–í–æ–π—Ç–∏</button>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('registerModal')">&times;</span>
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="regEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="regPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)">
            </div>
            <div class="form-group">
                <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                <input type="password" id="regPasswordConfirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <button class="btn" onclick="register()" style="width: 100%; margin-top: 20px;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </div>
    </div>

    <script>
        // ==========================================
        // SUPABASE –ù–ê–°–¢–†–û–ô–ö–ò
        // ==========================================
        const SUPABASE_URL = 'https://nemnrcljkzjpgcumgfsl.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5lbW5yY2xqa3pqcGdjdW1nZnNsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNjI3MzUsImV4cCI6MjA4MzYzODczNX0.4uvh66RCugFaiO55DV6CS1hAguS9rim66hyhsi-x68A';
        // ==========================================

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        if (SUPABASE_URL === 'YOUR_SUPABASE_URL' || SUPABASE_KEY === 'YOUR_SUPABASE_KEY') {
            document.getElementById('configWarning').style.display = 'block';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
        const { createClient } = window.supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

        let mediaLibrary = [];
        let currentUser = null;
        let selectedFile = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (session) {
                currentUser = session.user;
                updateUIForLoggedInUser();
            }

            // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
            supabaseClient.auth.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_IN') {
                    currentUser = session.user;
                    updateUIForLoggedInUser();
                } else if (event === 'SIGNED_OUT') {
                    currentUser = null;
                    document.getElementById('authButtons').style.display = 'flex';
                    document.getElementById('userInfo').style.display = 'none';
                }
            });

            await loadMedia();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –º–µ–¥–∏–∞ –∏–∑ –±–∞–∑—ã
        async function loadMedia() {
            try {
                const { data, error } = await supabaseClient
                    .from('media')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                mediaLibrary = data || [];
                renderMedia();
                updateStats();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                document.getElementById('mediaGrid').innerHTML = 
                    '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #e53e3e;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase.</div>';
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        async function register() {
            const email = document.getElementById('regEmail').value.trim();
            const password = document.getElementById('regPassword').value;
            const passwordConfirm = document.getElementById('regPasswordConfirm').value;

            if (!email || !password) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            if (password !== passwordConfirm) {
                alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                return;
            }

            if (password.length < 6) {
                alert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }

            try {
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                });

                if (error) throw error;

                alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.');
                closeModal('registerModal');
                
                document.getElementById('regEmail').value = '';
                document.getElementById('regPassword').value = '';
                document.getElementById('regPasswordConfirm').value = '';
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message);
            }
        }

        // –í—Ö–æ–¥
        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            try {
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password,
                });

                if (error) throw error;

                closeModal('loginModal');
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
            }
        }

        // –í—ã—Ö–æ–¥
        async function logout() {
            await supabaseClient.auth.signOut();
            document.getElementById('uploadSection').style.display = 'none';
        }

        function updateUIForLoggedInUser() {
            document.getElementById('authButtons').style.display = 'none';
            document.getElementById('userInfo').style.display = 'flex';
            document.getElementById('username').textContent = currentUser.email;
        }

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –∑–∞–≥—Ä—É–∑–∫–∏
        function toggleUpload() {
            const uploadSection = document.getElementById('uploadSection');
            uploadSection.style.display = uploadSection.style.display === 'none' ? 'block' : 'none';
        }

        // –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞
        function handleFileSelect(event) {
            selectedFile = event.target.files[0];
            if (selectedFile) {
                const fileName = selectedFile.name;
                const fileNameWithoutExt = fileName.substring(0, fileName.lastIndexOf('.')) || fileName;
                document.getElementById('uploadTitle').value = fileNameWithoutExt;
                document.getElementById('uploadText').textContent = `–í—ã–±—Ä–∞–Ω: ${fileName}`;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
        async function uploadFile() {
            if (!currentUser) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }

            if (!selectedFile) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
                return;
            }

            const title = document.getElementById('uploadTitle').value.trim();
            const author = document.getElementById('uploadAuthor').value.trim();
            const category = document.getElementById('uploadCategory').value;
            const year = document.getElementById('uploadYear').value.trim();
            const description = document.getElementById('uploadDescription').value.trim();

            if (!title) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
                return;
            }

            const uploadBtn = document.getElementById('uploadBtn');
            const progressBar = document.getElementById('progressBar');
            const progressBarFill = document.getElementById('progressBarFill');
            const fileUploadArea = document.getElementById('fileUploadArea');

            try {
                uploadBtn.disabled = true;
                uploadBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
                progressBar.style.display = 'block';
                fileUploadArea.classList.add('uploading');

                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
                let fileType = 'text';
                if (selectedFile.type.startsWith('audio')) fileType = 'audio';
                else if (selectedFile.type.startsWith('video')) fileType = 'video';

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
                const fileExt = selectedFile.name.split('.').pop();
                const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;
                const filePath = `${fileType}/${fileName}`;

                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ Storage
                progressBarFill.style.width = '30%';
                const { data: uploadData, error: uploadError } = await supabaseClient.storage
                    .from('media-files')
                    .upload(filePath, selectedFile);

                if (uploadError) throw uploadError;

                progressBarFill.style.width = '60%';

                // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏
                const { data: urlData } = supabaseClient.storage
                    .from('media-files')
                    .getPublicUrl(filePath);

                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É
                const { data: mediaData, error: dbError } = await supabaseClient
                    .from('media')
                    .insert([{
                        title: title,
                        author: author || '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                        category: category,
                        year: year || '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω',
                        description: description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è',
                        type: fileType,
                        file_url: urlData.publicUrl,
                        file_name: selectedFile.name,
                        file_size: (selectedFile.size / 1024 / 1024).toFixed(2),
                        user_id: currentUser.id,
                        user_email: currentUser.email
                    }])
                    .select();

                if (dbError) throw dbError;

                progressBarFill.style.width = '100%';

                // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
                document.getElementById('uploadTitle').value = '';
                document.getElementById('uploadAuthor').value = '';
                document.getElementById('uploadYear').value = '';
                document.getElementById('uploadDescription').value = '';
                document.getElementById('fileInput').value = '';
                document.getElementById('uploadText').textContent = '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞';
                selectedFile = null;

                alert('–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                toggleUpload();
                await loadMedia();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ' + error.message);
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = '‚úì –î–æ–±–∞–≤–∏—Ç—å –≤ –∞—Ä—Ö–∏–≤';
                progressBar.style.display = 'none';
                progressBarFill.style.width = '0%';
                fileUploadArea.classList.remove('uploading');
            }
        }

        // –†–µ–Ω–¥–µ—Ä –º–µ–¥–∏–∞
        function renderMedia(filteredLibrary = null) {
            const library = filteredLibrary || mediaLibrary;
            const grid = document.getElementById('mediaGrid');
            grid.innerHTML = '';

            if (library.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #718096;">–ó–∞–ø–∏—Å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }

            library.forEach((media) => {
                const card = document.createElement('div');
                card.className = 'media-card';
                
                let icon = 'üìÑ';
                if (media.type === 'audio') icon = 'üéµ';
                else if (media.type === 'video') icon = 'üé¨';
                else if (media.type === 'text') {
                    if (media.category === 'book') icon = 'üìö';
                    else if (media.category === 'article') icon = 'üì∞';
                    else if (media.category === 'research') icon = 'üî¨';
                    else if (media.category === 'thesis') icon = 'üéì';
                }
                
                card.innerHTML = `
                    <div class="media-icon">${icon}</div>
                    <div class="media-title">${media.title}</div>
                    <div class="media-info">üë§ ${media.author}</div>
                    <div class="media-info">üìÖ ${media.year}</div>
                    <div class="media-info">üìÇ ${getCategoryName(media.category)}</div>
                    <div class="media-info" style="font-size: 0.8em; color: #a0aec0; margin-top: 10px; font-style: italic;">${media.description}</div>
                    <div class="media-info">üíæ ${media.file_size} MB</div>
                    <div class="media-info" style="font-size: 0.75em; color: #cbd5e0;">–ó–∞–≥—Ä—É–∑–∏–ª: ${media.user_email}</div>
                    <div class="media-controls">
                        <button class="btn btn-small" onclick="playMedia('${media.file_url}', '${media.type}', '${media.title}')">‚ñ∂ –û—Ç–∫—Ä—ã—Ç—å</button>
                        <button class="btn btn-small" onclick="downloadMedia('${media.file_url}', '${media.file_name}')">‚¨á –°–∫–∞—á–∞—Ç—å</button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function getCategoryName(category) {
            const categories = {
                music: '–ú—É–∑—ã–∫–∞',
                speech: '–†–µ—á—å',
                interview: '–ò–Ω—Ç–µ—Ä–≤—å—é',
                documentary: '–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ',
                film: '–§–∏–ª—å–º',
                lecture: '–õ–µ–∫—Ü–∏—è',
                book: '–ö–Ω–∏–≥–∞',
                article: '–°—Ç–∞—Ç—å—è',
                research: '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',
                thesis: '–î–∏—Å—Å–µ—Ä—Ç–∞—Ü–∏—è',
                other: '–î—Ä—É–≥–æ–µ'
            };
            return categories[category] || category;
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º–µ–¥–∏–∞
        function playMedia(fileUrl, type, title) {
            const playerSection = document.getElementById('playerSection');
            const playerTitle = document.getElementById('playerTitle');
            const playerContainer = document.getElementById('playerContainer');

            playerTitle.textContent = `‚ñ∂ ${title}`;
            
            if (type === 'video') {
                playerContainer.innerHTML = `
                    <video controls style="width: 100%;">
                        <source src="${fileUrl}" type="video/mp4">
                        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                    </video>
                `;
            } else if (type === 'audio') {
                playerContainer.innerHTML = `
                    <audio controls style="width: 100%;">
                        <source src="${fileUrl}" type="audio/mpeg">
                        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ.
                    </audio>
                `;
            } else {
                playerContainer.innerHTML = `
                    <iframe src="${fileUrl}" style="width: 100%; height: 600px; border: none; border-radius: 12px;"></iframe>
                `;
            }

            playerSection.style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
        function downloadMedia(fileUrl, fileName) {
            const a = document.createElement('a');
            a.href = fileUrl;
            a.download = fileName;
            a.click();
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('filterType').value;
            const categoryFilter = document.getElementById('filterCategory').value;

            let filtered = mediaLibrary.filter(media => {
                const matchesSearch = media.title.toLowerCase().includes(searchTerm) ||
                                    media.author.toLowerCase().includes(searchTerm) ||
                                    media.description.toLowerCase().includes(searchTerm);
                
                const matchesType = typeFilter === 'all' || media.type === typeFilter;
                const matchesCategory = categoryFilter === 'all' || media.category === categoryFilter;

                return matchesSearch && matchesType && matchesCategory;
            });

            renderMedia(filtered);
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterType').value = 'all';
            document.getElementById('filterCategory').value = 'all';
            renderMedia();
        }

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        function updateStats() {
            document.getElementById('totalMedia').textContent = mediaLibrary.length;
            document.getElementById('totalAudio').textContent = mediaLibrary.filter(m => m.type === 'audio').length;
            document.getElementById('totalVideo').textContent = mediaLibrary.filter(m => m.type === 'video').length;
            document.getElementById('totalText').textContent = mediaLibrary.filter(m => m.type === 'text').length;
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = init;
    </script>
</body>
</html>
